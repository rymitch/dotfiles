#!/usr/bin/env bash

if [ "$1" == "" ]; then
  echo Syntax: bkhg NAME
  exit 1
fi

REPO=$1

if [ ! -d $REPO/.hg ]; then
  echo Error: $REPO does not exists or is not an hg repository.
  exit 1
fi

TEMPDIR=`mktemp -d`
CLONE=$TEMPDIR/$REPO
TARNAME=$HOSTNAME.$REPO.`date +%Y%m%d.%H%M%S`

echo Starting at `date +%H:%M:%S`.
echo

echo Cloning $REPO to $CLONE...
hg clone -U $REPO $CLONE
echo

echo Creating $TARNAME...
tarsnap -cvf $TARNAME -C $TEMPDIR $REPO
echo

echo Cleaning up temp directory...
rm -rf $TEMPDIR
echo

echo Finished at `date +%H:%M:%S`.
